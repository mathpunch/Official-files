<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Games</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#070b14;
  color:white;
  overflow:hidden;
  height:100vh;
  width:100vw;
}
.icon{
  width:24px;
  height:24px;
  stroke:rgba(255,255,255,.65);
  stroke-width:2;
  fill:none;
  transition:.2s ease;
  cursor:pointer;
}
.icon:hover{stroke:white;}
.top-bar-container{
  position:fixed;
  top:10px;
  left:0;
  right:0;
  display:flex;
  justify-content:center;
  z-index:20;
}
.top-bar-content{display:flex;gap:12px;}
.search-bar{
  height:48px;
  padding:0 14px;
  display:flex;
  align-items:center;
  gap:10px;
  background:rgba(255,255,255,.06);
  border-radius:14px;
  border:1.5px solid rgba(255,255,255,.08);
}
.search-bar input{
  background:none;
  border:none;
  outline:none;
  color:white;
  font-size:16px;
  width:240px;
}
#container{
  margin-top:64px;
  display:grid;
  grid-template-columns:repeat(4,220px);
  justify-content:center;
  gap:12px;
  padding:12px 12px 100px;
  max-height:calc(100vh - 64px);
  overflow-y:auto;
}
#container::-webkit-scrollbar{display:none;}
.zone-item{
  width:220px;
  height:175px;
  border-radius:16px;
  position:relative;
  overflow:hidden;
  background:rgba(255,255,255,.08);
  cursor:pointer;
  transition:transform .2s;
}
.zone-item:hover{transform:scale(1.03);}
.zone-item img{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  opacity:0;
  transition:opacity .8s;
}
.zone-item img[src]{opacity:1;}
.zone-item::before{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0);
  backdrop-filter:blur(0);
  transition:.15s;
  z-index:1;
}
.zone-item:hover::before{
  background:rgba(0,0,0,.45);
  backdrop-filter:blur(10px);
}
.zone-item button{
  position:relative;
  z-index:2;
  margin:12px;
  background:none;
  border:none;
  color:white;
  font-size:22px;
  opacity:0;
  transition:.3s;
  pointer-events:none;
  text-align:left;
}
.zone-item:hover button{opacity:1;}
#zoneViewer{
  position:fixed;
  inset:0;
  background:#000;
  z-index:1000;
  display:none;
  flex-direction:row;
}
#zoneSidebar{
  width:60px;
  background:rgba(20,20,20,.9);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:12px 0;
  gap:24px;
  border-right:1px solid rgba(255,255,255,.1);
}
#zoneFrame{
  flex:1;
  border:none;
  width:100%;
  height:100%;
}
@media(max-width:1000px){#container{grid-template-columns:repeat(3,220px);}}
@media(max-width:750px){#container{grid-template-columns:repeat(2,1fr);}}
@media(max-width:450px){#container{grid-template-columns:1fr;}}
</style>
</head>
<body>

<div class="top-bar-container">
  <div class="top-bar-content">
    <div class="search-bar">
      <svg class="icon" viewBox="0 0 24 24">
        <circle cx="11" cy="11" r="7"/>
        <line x1="16.5" y1="16.5" x2="21" y2="21"/>
      </svg>
      <input id="searchBar" placeholder="Search" oninput="filterZones()">
    </div>
  </div>
</div>

<div id="container"></div>

<div id="zoneViewer">
  <div id="zoneSidebar">
    <svg class="icon" viewBox="0 0 24 24" onclick="closeZone()">
      <polyline points="15 18 9 12 15 6"/>
    </svg>
    <svg class="icon" viewBox="0 0 24 24" onclick="if(zoneFrame.requestFullscreen){zoneFrame.requestFullscreen();}">
      <polyline points="4 4 4 10 10 10"/>
      <polyline points="20 20 20 14 14 14"/>
      <line x1="14" y1="10" x2="20" y2="4"/>
      <line x1="4" y1="20" x2="10" y2="14"/>
    </svg>
    <svg class="icon" viewBox="0 0 24 24" onclick="window.open(zoneFrame.src,'_blank')">
      <polyline points="18 13 18 18 6 18 6 6 11 6"/>
      <line x1="15" y1="9" x2="21" y2="3"/>
      <polyline points="21 3 21 9 15 9"/>
    </svg>
  </div>
  <iframe id="zoneFrame"></iframe>
</div>

<script>
const container=document.getElementById("container");
const zoneViewer=document.getElementById("zoneViewer");
const zoneFrame=document.getElementById("zoneFrame");
const searchBar=document.getElementById("searchBar");
const coverURL="https://cdn.jsdelivr.net/gh/gn-math/covers@main";
const htmlURL="https://cdn.jsdelivr.net/gh/gn-math/html@main";
let zones=[];
async function listZones(){
  try{
    const r=await fetch("https://cdn.jsdelivr.net/gh/gn-math/assets@latest/zones.json");
    zones=await r.json();
    displayZones(zones);
  }catch{
    container.innerHTML="<p style='text-align:center'>Failed to load games.</p>";
  }
}
function displayZones(list){
  container.innerHTML="";
  list.forEach(z=>{
    const d=document.createElement("div");
    d.className="zone-item";
    d.onclick=()=>openZone(z);
    const i=document.createElement("img");
    i.dataset.src=z.cover?z.cover.replace("{COVER_URL}",coverURL):"";
    i.className="lazy-zone-img";
    const b=document.createElement("button");
    b.textContent=z.name||"Unnamed";
    d.append(i,b);
    container.appendChild(d);
  });
  observeLazyImages();
}
function observeLazyImages(){
  const imgs=document.querySelectorAll(".lazy-zone-img");
  const io=new IntersectionObserver(e=>{
    e.forEach(x=>{
      if(x.isIntersecting){
        x.target.src=x.target.dataset.src;
        io.unobserve(x.target);
      }
    });
  });
  imgs.forEach(i=>io.observe(i));
}
function filterZones(){
  const q=searchBar.value.toLowerCase();
  displayZones(zones.filter(z=>z.name.toLowerCase().includes(q)));
}
function openZone(z){
  if(!z.url)return;
  const url=z.url.replace("{HTML_URL}",htmlURL);
  fetch(url).then(r=>r.text()).then(t=>{
    zoneFrame.src=URL.createObjectURL(new Blob([t],{type:"text/html"}));
    zoneViewer.style.display="flex";
  });
}
function closeZone(){
  zoneFrame.src="";
  zoneViewer.style.display="none";
}
listZones();
</script>

</body>
</html>
